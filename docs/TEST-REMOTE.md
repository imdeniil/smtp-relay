# ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ SMTP Relay Ñ Ð£Ð´Ð°Ð»ÐµÐ½Ð½Ð¾Ð³Ð¾ Ð¡ÐµÑ€Ð²ÐµÑ€Ð°

## ðŸ“‹ ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ

Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ `test-remote.sh` Ð¿Ñ€ÐµÐ´Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½ Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ SMTP relay Ñ ÑƒÐ´Ð°Ð»ÐµÐ½Ð½Ð¾Ð³Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ð°. ÐžÐ½ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚:

- âœ… Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ Ð¿Ð¾Ñ€Ñ‚Ð°
- âœ… SMTP EHLO ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ
- âœ… STARTTLS ÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
- âœ… SASL Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸ÑŽ
- âœ… ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÑƒ Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ð¸ÑÑŒÐ¼Ð°

---

## ðŸš€ Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ Ð¡Ñ‚Ð°Ñ€Ñ‚

### ÐÐ° Ð¡ÐµÑ€Ð²ÐµÑ€Ðµ SMTP Relay

```bash
# Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð½Ð° ÑƒÐ´Ð°Ð»ÐµÐ½Ð½Ñ‹Ð¹ ÑÐµÑ€Ð²ÐµÑ€
scp test-remote.sh user@remote-server:/tmp/
```

### ÐÐ° Ð£Ð´Ð°Ð»ÐµÐ½Ð½Ð¾Ð¼ Ð¡ÐµÑ€Ð²ÐµÑ€Ðµ

```bash
# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ñ‚ÐµÑÑ‚
/tmp/test-remote.sh keemor.su 6025 keemor821@gmail.com nsH7BJJFzw1l
```

---

## ðŸ’» Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 1: Ð¡ ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ð¼Ð¸ Ð¸Ð· .env

Ð•ÑÐ»Ð¸ `.env` Ñ„Ð°Ð¹Ð» Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½:

```bash
./test-remote.sh
```

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 2: Ð¡ ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°Ð¼Ð¸ ÐšÐ¾Ð¼Ð°Ð½Ð´Ð½Ð¾Ð¹ Ð¡Ñ‚Ñ€Ð¾ÐºÐ¸

```bash
./test-remote.sh HOST PORT USERNAME PASSWORD
```

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
```bash
./test-remote.sh keemor.su 6025 keemor821@gmail.com nsH7BJJFzw1l
```

---

## ðŸ“Š Ð§Ñ‚Ð¾ ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ÑÑ

### Ð¢ÐµÑÑ‚ 1: Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ ÐŸÐ¾Ñ€Ñ‚Ð°
ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ TCP Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº SMTP ÑÐµÑ€Ð²ÐµÑ€Ñƒ.

### Ð¢ÐµÑÑ‚ 2: SMTP EHLO
ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ð±Ð°Ð·Ð¾Ð²Ð¾Ðµ SMTP ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ð¸ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ ÑÐµÑ€Ð²ÐµÑ€Ð°.

### Ð¢ÐµÑÑ‚ 3: STARTTLS
ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ TLS ÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ (Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ OpenSSL).

### Ð¢ÐµÑÑ‚ 4: ÐÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ
ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ SASL AUTH LOGIN Ñ Ð²Ð°ÑˆÐ¸Ð¼Ð¸ credentials.

### Ð¢ÐµÑÑ‚ 5: Python Ð¢ÐµÑÑ‚
ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ðµ Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ðµ Ð¿Ð¸ÑÑŒÐ¼Ð¾ (Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Python3).

---

## âœ… ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚

```
========================================
âœ… Ð’Ð¡Ð• Ð¢Ð•Ð¡Ð¢Ð« ÐŸÐ ÐžÐ™Ð”Ð•ÐÐ«!
========================================

SMTP Relay Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÐµÐ½ Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ñ ÑƒÐ´Ð°Ð»ÐµÐ½Ð½Ð¾Ð³Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ð°.

ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð´Ð»Ñ Ð²Ð°ÑˆÐµÐ³Ð¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ:
  SMTP Host:     keemor.su
  SMTP Port:     6025
  SMTP User:     keemor821@gmail.com
  SMTP Password: (Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð²Ð°Ñˆ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ)
  Use STARTTLS:  true
  Sender (FROM): *@keemor.su
```

---

## ðŸ”§ Ð¢Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ

### ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ðµ (Ð´Ð»Ñ Ð±Ð°Ð·Ð¾Ð²Ñ‹Ñ… Ñ‚ÐµÑÑ‚Ð¾Ð²)
- `bash`
- `nc` (netcat)

### Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÐ¼Ñ‹Ðµ (Ð´Ð»Ñ Ð¿Ð¾Ð»Ð½Ñ‹Ñ… Ñ‚ÐµÑÑ‚Ð¾Ð²)
- `openssl` - Ð´Ð»Ñ STARTTLS Ñ‚ÐµÑÑ‚Ð°
- `python3` - Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ Ð¿Ð¸ÑÑŒÐ¼Ð°

### Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹

**Ubuntu/Debian:**
```bash
apt-get update
apt-get install -y netcat-openbsd openssl python3
```

**CentOS/RHEL:**
```bash
yum install -y nc openssl python3
```

**Alpine:**
```bash
apk add bash netcat-openbsd openssl python3
```

---

## ðŸ› Troubleshooting

### ÐžÑˆÐ¸Ð±ÐºÐ°: "ÐŸÐ¾Ñ€Ñ‚ Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½"

**ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°:** Firewall Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÐµÑ‚ Ð¸ÑÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ.

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:**
```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ firewall
iptables -L OUTPUT -n | grep 6025

# Ð Ð°Ð·Ñ€ÐµÑˆÐ¸Ñ‚Ðµ Ð¸ÑÑ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚ 6025
iptables -A OUTPUT -p tcp --dport 6025 -j ACCEPT
```

---

### ÐžÑˆÐ¸Ð±ÐºÐ°: "STARTTLS ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾"

**ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°:** OpenSSL Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð¸Ð»Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ñ TLS.

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:**
```bash
# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ OpenSSL
apt-get install openssl

# Ð˜Ð»Ð¸ Ð¿Ñ€Ð¾Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ STARTTLS Ñ‚ÐµÑÑ‚ - Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð²ÑÐµ Ñ€Ð°Ð²Ð½Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚
```

---

### ÐžÑˆÐ¸Ð±ÐºÐ°: "ÐÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð½Ðµ ÑƒÐ´Ð°Ð»Ð°ÑÑŒ (ÐºÐ¾Ð´ 535)"

**ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°:** ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ðµ credentials.

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:**
1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ username Ð¸ password
2. Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ Ñ‡Ñ‚Ð¾ SASL Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ ÑÐ¾Ð·Ð´Ð°Ð½ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ:
   ```bash
   ./manage.sh users
   ```

---

### ÐžÑˆÐ¸Ð±ÐºÐ°: "Sender address rejected"

**ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°:** Sender Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ñ Ð´Ð¾Ð¼ÐµÐ½Ð¾Ð¼ `@keemor.su`.

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:**
Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ sender. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ‡Ñ‚Ð¾ Ð² Ð»Ð¾Ð³Ð°Ñ… Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ `*@keemor.su`.

---

## ðŸ“ ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ

### Ð¢ÐµÑÑ‚ Ð¸Ð· Docker ÐšÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°

```bash
docker run -it --rm ubuntu:22.04 bash -c "
  apt-get update && apt-get install -y curl nc openssl python3 && \
  curl -o test.sh https://your-server/test-remote.sh && \
  chmod +x test.sh && \
  ./test.sh keemor.su 6025 keemor821@gmail.com nsH7BJJFzw1l
"
```

---

### ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¸Ð· CI/CD

```yaml
# GitLab CI
test_smtp:
  script:
    - apt-get update && apt-get install -y netcat openssl python3
    - ./test-remote.sh $SMTP_HOST $SMTP_PORT $SMTP_USER $SMTP_PASS
```

```yaml
# GitHub Actions
- name: Test SMTP
  run: |
    sudo apt-get install -y netcat openssl python3
    ./test-remote.sh ${{ secrets.SMTP_HOST }} ${{ secrets.SMTP_PORT }} ${{ secrets.SMTP_USER }} ${{ secrets.SMTP_PASS }}
```

---

## ðŸ” Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ

**âš ï¸ Ð’ÐÐ–ÐÐž:** Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ Ð² ÐºÐ¾Ð¼Ð°Ð½Ð´Ð½Ð¾Ð¹ ÑÑ‚Ñ€Ð¾ÐºÐµ!

### Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾Ðµ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ

**Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 1:** Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `.env` Ñ„Ð°Ð¹Ð»
```bash
# Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ .env Ð½Ð° ÑƒÐ´Ð°Ð»ÐµÐ½Ð½Ð¾Ð¼ ÑÐµÑ€Ð²ÐµÑ€Ðµ
cat > .env << EOF
RELAY_MYDOMAIN=keemor.su
SMTP_PORT=6025
SASL_USERNAME=keemor821@gmail.com
SASL_PASSWORD=nsH7BJJFzw1l
EOF

chmod 600 .env
./test-remote.sh
```

**Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 2:** Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
```bash
export SMTP_HOST=keemor.su
export SMTP_PORT=6025
export SMTP_USER=keemor821@gmail.com
export SMTP_PASS=nsH7BJJFzw1l

./test-remote.sh $SMTP_HOST $SMTP_PORT $SMTP_USER $SMTP_PASS

# ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚Ðµ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ
history -c
```

---

## ðŸ“ž ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°

Ð•ÑÐ»Ð¸ Ñ‚ÐµÑÑ‚Ñ‹ Ð½Ðµ Ð¿Ñ€Ð¾Ñ…Ð¾Ð´ÑÑ‚:

1. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸ Ð½Ð° SMTP ÑÐµÑ€Ð²ÐµÑ€Ðµ:**
   ```bash
   ./manage.sh logs
   ```

2. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑ ÑÐµÑ€Ð²Ð¸ÑÐ°:**
   ```bash
   ./manage.sh status
   ```

3. **Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÑƒ:**
   ```bash
   ./manage.sh diagnose
   ```

---

## ðŸ“„ Ð›Ð¸Ñ†ÐµÐ½Ð·Ð¸Ñ

MIT License

---

**Ð’ÐµÑ€ÑÐ¸Ñ:** 2.1.0
**Ð”Ð°Ñ‚Ð°:** 2024-10-22
**ÐÐ²Ñ‚Ð¾Ñ€:** Claude Code
